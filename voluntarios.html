<!DOCTYPE html>
<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Tempo de Florescer - Seja Volunt√°rio</title>

    <link rel="stylesheet" href="./voluntarios.css">

    <link rel="stylesheet" href="./css/responsivo.css">
    
    </head>

<body>

 <header class="header">
        <nav>
            <div>
                <img src="./img/novalogo.png" alt="Logo da organiza√ß√£o">
            </div>

            <div id="navContainer" class="alinhamento">
                </div>
        </nav>
    
    </header>

 <section class="hero">
        <div class="leaf-decoration"></div>
        <h1>SEJA A SEMETE: FA√áA PARTE DO FLORESCER</h1>
        <h2>DOE SEU TEMPO E SUAS HABILIDADES POR CAUSAS AMBIENTAIS E SOCIAIS</h2>
        <p>TEMOS O LUGAR CERTO ESPERANDO POR VOC√ä!</p>
    </section>

 <section class="areas">
        <h2 class="section-title">Onde seu tempo pode florescer?</h2>
        <div class="areas-container">
           <div class="area-card">
                <img src="./img/reflorestamento.png" alt="Reflorestamento">
                <div class="card-content">
                  <h3>Reflorestamento e Preserva√ß√£o</h3>
                  <p>A√ß√µes de campo, plantio, manejo e recupera√ß√£o de √°reas degradadas.</p>
                  <span class="tag">Presencial</span>
                  <span class="tag">Meio Ambiente</span>
                  <a href="#" class="btn-candidatar">Me candidatar</a>
                     </div>
                 </div>
            <div class="area-card">
              <img src="./img/cultivocomunitario.png" alt="Cultivo Comunit√°rio">
              <div class="card-content">
                     <h3>Cultivo e Estufas Comunit√°rias</h3>
                     <p>Cuidado com horta, produ√ß√£o de mudas e educa√ß√£o alimentar.</p>
                     <span class="tag">Presencial</span>
                  <span class="tag">Meio Ambiente</span>
                  <a href="#" class="btn-candidatar">Me candidatar</a>
                     </div>
             </div>
           <div class="area-card">
                <img src="./img/aulas.png" alt="Campanhas Educativas">
                <div class="card-content">
                  <h3>Campanhas Educativas</h3>
                  <p>A√ß√µes que levam informa√ß√µes pr√°ticas sobre sustentabilidade para escolas e
                          comunidades.</p>
                  <span class="tag">Presencial</span>
                  <span class="tag">Comunidade</span>
                  <a href="#" class="btn-candidatar">Me candidatar</a>
                     </div>
                 </div>
           <div class="area-card">
                <img src="./img/upcycling.png" alt="Upcycling">
                <div class="card-content">
                  <h3>Upcycling e Moda Sustent√°vel</h3>
                  <p>Atividades que transformam produtos descartados, visando o aproveitamento de
                          forma criativa e consciente.</p>
                  <span class="tag">Presencial</span>
                  <span class="tag">Arte/Design</span>
                  <a href="#" class="btn-candidatar">Me candidatar</a>
                     </div>
                 </div>
             </div>
     </section>

 <section class="testimonials">
        <h2 class="section-title">O que dizem nossas sementes?</h2>
        <div class="testimonials-container">
           <div class="testimonial-card">
                <p>"Comecei com muito medo, por√©m a for√ßa da comunidade me transformou... Hoje o Tempo
                     de Florescer √© a minha segunda fam√≠lia."</p>
                <span class="author">- Ana F. Souza</span>
              </div>
           <div class="testimonial-card">
                <p>"Me inscrevi sem saber ao certo o que esperar, mas encontrei prop√≥sito e satisfa√ß√£o.
                     Cada atividade me faz perceber o quanto pequenas a√ß√µes transformam vidas."</p>
                <span class="author">- Carla M. Ribeiro</span>
              </div>
           <div class="testimonial-card">
                <p>"Entrei achando que ia s√≥ separar lixo... agora j√° dei nome pras minhas minhocas!
                     Antes, nem sabia que papel n√£o √© tudo que joga papel no ch√£o. A ONG despertou meu lado social do
                     plantio e reciclagem."</p>
                <span class="author">- Lucas P. Andrade</span>
                </div>
            </div>
        <div class="newsletter-form">
           <p>Receba aqui sua experi√™ncia:</p>
           <input type="email" placeholder="Seu melhor e-mail">
           <button>Enviar</button>
             </div>
     </section>

 <section class="process">
        <div class="process-header">
          üå± Nosso processo em 3 Passos
            </div>
        <div class="steps-container">
           <div class="step">
                <span class="step-number">1</span>
                <h3>Cadastra-se</h3>
                <p>Crie ou Entre na sua conta e explique o por que voc√™ deseja esta vaga.</p>
              </div>
           <div class="step">
                <span class="step-number">2</span>
                <h3>Receba a Confirma√ß√£o</h3>
                <p>Nossa equipe encontra a vaga e envia as informa√ß√µes por e-mail.</p>
              </div>
           <div class="step">
                <span class="step-number">3</span>
                <h3>Comece a Plantar</h3>
                <p>Participe e inicie os trabalhos.</p>
              </div>
             </div>
        <div class="start-now">
           <a href="./entrar.html">Quero come√ßar agora!</a>
           <p class="doubt-contact">Tenho uma d√∫vida. <a href="./contatos.html">Contato</a></p>
             </div>
     </section>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>A√ß√£o Necess√°ria</h2>
            <p>Voc√™ n√£o est√° logado. Para se candidatar a esta vaga, por favor, entre na sua conta ou crie um novo
                cadastro.</p>
            <div class="modal-actions">
                <button id="btnModalEntrar" class="btn-primary">Entrar / Criar Conta</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const BASE_URL = 'http://localhost:3001';
            const NAV_CONTAINER = document.getElementById('navContainer');

            // Menu Est√°tico (Links Padr√£o)
            const menuEstaticoLinks = `
                <li><a href="./index.html">Home</a></li> 
                <li><a href="./quemsomos.html">Quem somos</a></li>
                <li><a href="./contatos.html">Contato</a></li>
                <li><a href="./doacao.html">Doe</a></li>
                <li><a href="./voluntarios.html">Volunt√°rios</a></li>
                <li><a href="entrarempresa.html">Empresas</a></li> 
            `;

            // Menu de navega√ß√£o para usu√°rios LOGADOS (Com Perfil e Sair)
            const menuLogadoHTML = (voluntarioId, nomeVoluntario) => `
                <ul>
                    <li><a href="./index.html">Home</a></li> 
                    <li><a href="./quemsomos.html">Quem somos</a></li>
                    <li><a href="./contatos.html">Contato</a></li>
                    <li><a href="./doacao.html">Doe</a></li>
                    <li><a href="./voluntarios.html">Volunt√°rios</a></li>
                    <li><a href="./perfil.html?id=${voluntarioId}">üë§ Perfil (${nomeVoluntario.split(' ')[0]})</a></li> 
                    <li><a href="#" id="btnLogout">Sair</a></li>
                </ul>
            `;
            
            // --- FUN√á√ïES DE LOGOUT ---
            const setupLogout = (voluntarioId) => {
                const btnLogout = document.getElementById('btnLogout');
                if (btnLogout) {
                    btnLogout.addEventListener('click', async (e) => {
                        e.preventDefault();
                        
                        try {
                            const response = await fetch(`${BASE_URL}/api/auth/logout`, {
                                method: 'GET', 
                                credentials: 'include'
                            });
                            
                            if (response.ok) {
                                // Logout realizado com sucesso, recarrega a p√°gina para o estado deslogado
                                window.location.reload(); 
                            } else {
                                alert("Erro ao fazer logout.");
                            }
                        } catch (error) {
                            console.error('Erro de conex√£o ao tentar logout:', error);
                            alert('Erro de conex√£o com o servidor.');
                        }
                    });
                }
            };

            // --- FUN√á√ÉO PRINCIPAL: VERIFICAR E CARREGAR NAV ---
            const verificarEcarregarNav = async () => {
                try {
                    // üîë Usa o novo endpoint: /api/auth/check
                    const response = await fetch(`${BASE_URL}/api/auth/check`, {
                        method: 'GET',
                        credentials: 'include' // Essencial para enviar o Cookie de Sess√£o
                    });
                    const data = await response.json();

                    // Se a resposta for OK (c√≥digo 200) e o payload indicar login...
                    if (response.ok && data.isLoggedIn && data.user) {
                        
                        const idVoluntario = data.user.id;
                        const nomeVoluntario = data.user.nome || 'Volunt√°rio';

                        // 1. LOGADO: Injeta o menu com o √çCONE DE PERFIL e BOT√ÉO SAIR
                        NAV_CONTAINER.innerHTML = menuLogadoHTML(idVoluntario, nomeVoluntario);

                        // 2. Configura a fun√ß√£o de Logout no novo bot√£o
                        setupLogout(idVoluntario);

                    } else {
                        // N√ÉO LOGADO: Injeta o Menu Est√°tico
                        NAV_CONTAINER.innerHTML = `<ul>${menuEstaticoLinks}</ul>`;

                        // 3. Configura o bot√£o "Entrar / Criar Conta" do modal
                        const btnModalEntrar = document.getElementById('btnModalEntrar');
                        if (btnModalEntrar) {
                            btnModalEntrar.addEventListener('click', () => {
                                window.location.href = './entrar.html'; // Redireciona para a p√°gina de login/cadastro
                            });
                        }
                    }
                } catch (error) {
                    console.error('Erro de conex√£o ou carregamento:', error);
                    // Em caso de erro, exibe o menu est√°tico como fallback
                    NAV_CONTAINER.innerHTML = `<ul>${menuEstaticoLinks}</ul>`;
                }
            };

            verificarEcarregarNav(); // Executa ao carregar a p√°gina


            // --- L√ìGICA DO CLIQUE NOS BOT√ïES "ME CANDIDATAR" ---
            const authModal = document.getElementById('authModal');
            const hideModal = () => { if (authModal) authModal.style.display = 'none'; };
            const closeModal = document.querySelector('.close-button');
            if (closeModal) closeModal.addEventListener('click', hideModal);
            window.addEventListener('click', (event) => { if (event.target === authModal) hideModal(); });
            
            const btnCandidatarList = document.querySelectorAll('.btn-candidatar');

            btnCandidatarList.forEach(btnCandidatar => {
                btnCandidatar.onclick = async (e) => {
                    e.preventDefault();

                    try {
                        // üîë Usa o novo endpoint: /api/auth/check
                        const response = await fetch(`${BASE_URL}/api/auth/check`, { credentials: 'include' });
                        const data = await response.json();

                        // Verifica se est√° logado como Volunt√°rio
                        if (response.ok && data.isLoggedIn && data.user) {
                            alert(`Sucesso, ${data.user.nome.split(' ')[0]}! Voc√™ est√° logado e pode prosseguir com a candidatura.`);
                            // ‚ö†Ô∏è Substitua esta linha pela URL da sua p√°gina de candidatura final
                            // window.location.href = '/candidatura-vaga-ativa.html'; 
                        } else {
                            // N√ÉO LOGADO: MOSTRA O MODAL!
                            if (authModal) authModal.style.display = 'flex';
                        }
                    } catch (error) {
                        console.error('Erro ao verificar status:', error);
                        alert('Erro de conex√£o com o servidor de autentica√ß√£o.');
                    }
                };
            });
        });
    </script>
</body>

</html>